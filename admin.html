<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="manifest" href="/manifest.json">
<title>Admin Panel</title>
<style>
body{font-family:system-ui;background:#0f172a;color:white;padding:15px}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #334155;padding:6px;text-align:center}
button{padding:5px 8px}
</style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ">
<input id="days" placeholder="Ù…Ø¯Ø© (Ø£ÙŠØ§Ù…)">
<button onclick="generate()">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯</button>

<table id="tbl">
<tr><th>Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ù†Ø³Ø®</th><th>Ø­Ø§Ù„Ø©</th><th>Ø­Ø°Ù</th></tr>
</table>

<script>
const token = localStorage.getItem("ADMIN_TOKEN") || prompt("Ø§Ø¯Ø®Ù„ ADMIN TOKEN")
localStorage.setItem("ADMIN_TOKEN", token)

async function generate(){
  await fetch("/admin/generate",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "x-admin-token":token
    },
    body:JSON.stringify({
      customer_name:name.value,
      days:days.value
    })
  })
  load()
}

async function load(){
  const res = await fetch("/admin/codes",{headers:{"x-admin-token":token}})
  const data = await res.json()
  tbl.innerHTML = `<tr><th>Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ù†Ø³Ø®</th><th>Ø­Ø§Ù„Ø©</th><th>Ø­Ø°Ù</th></tr>`
  data.forEach(r=>{
    tbl.innerHTML+=`
    <tr>
      <td>${r[2]||""}</td>
      <td>${r[1]}</td>
      <td><button onclick="copy('${r[1]}')">ğŸ“‹</button></td>
      <td><button onclick="toggle(${r[0]})">${r[3]?'ğŸŸ¢':'ğŸ”´'}</button></td>
      <td><button onclick="del(${r[0]})">âŒ</button></td>
    </tr>`
  })
}

function copy(c){navigator.clipboard.writeText(c)}
function toggle(id){fetch(`/admin/code/${id}/toggle`,{method:"PUT",headers:{"x-admin-token":token}}).then(load)}
function del(id){fetch(`/admin/code/${id}`,{method:"DELETE",headers:{"x-admin-token":token}}).then(load)}

load()
</script>
</body>
</html>