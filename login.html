<script>
function getDeviceId() {
  let deviceId = localStorage.getItem("device_id");
  if (!deviceId) {
    deviceId = crypto.randomUUID();
    localStorage.setItem("device_id", deviceId);
  }
  return deviceId;
}

function activate() {
  const code = document.getElementById("code").value.trim();
  if (!code) return;

  const deviceId = getDeviceId();

  fetch("https://deep2-0z0k.onrender.com/activate", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      code: code,
      device_id: deviceId
    })
  })
  .then(async r => {
    const data = await r.json();
    if (!r.ok) throw data;
    return data;
  })
  .then(d => {
    if (d.status === "activated") {
      localStorage.setItem("activated", "1");
      document.getElementById("success").style.display = "block";
      document.getElementById("error").style.display = "none";
      setTimeout(() => location.href = "app.html", 800);
    }
  })
  .catch(err => {
    document.getElementById("error").style.display = "block";
    document.getElementById("success").style.display = "none";

    console.error("Activation error:", err);
  });
}
</script>